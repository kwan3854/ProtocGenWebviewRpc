// AUTO-GENERATED by protoc-gen-webviewrpc
using Cysharp.Threading.Tasks;
using Google.Protobuf;
using WebViewRPC;

namespace {{.CsharpNamespace}}
{
    /// <summary>
    /// Override your own implementation of this class
    /// </summary>
    public abstract class {{.ServiceName}}Base
    {
        {{range .Methods}}
        public abstract UniTask<{{.OutputType}}> {{.MethodName}}({{.InputType}} request);
        {{end}}
    }

    /// <summary>
    /// Provides "BindService" method to bind your implementation to the generated service definition.
    /// Works similar to gRPC's ServerServiceDefinition.BindService.
    /// </summary>
    public static class {{.ServiceName}}
    {
        public static ServiceDefinition BindService({{.ServiceName}}Base impl)
        {
            var def = new ServiceDefinition();

            {{range .Methods}}
            def.AsyncMethodHandlers["{{$.ServiceName}}.{{.MethodName}}"] = async (reqBytes) =>
            {
                var req = new {{.InputType}}();
                req.MergeFrom(reqBytes);
                var resp = await impl.{{.MethodName}}(req);
                return Google.Protobuf.ByteString.CopyFrom(resp.ToByteArray());
            };
            {{end}}

            return def;
        }
    }
}
